"use strict";(()=>{var e={};e.id=592,e.ids=[592],e.modules={145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},7771:(e,t,a)=>{a.r(t),a.d(t,{config:()=>c,default:()=>d,routeModule:()=>u});var r={};a.r(r),a.d(r,{default:()=>Home});var o=a(1802),l=a(7153),s=a(6249);let n=require("react/jsx-runtime"),i=require("react");function Home(){let[e,t]=(0,i.useState)([]),[a,r]=(0,i.useState)(""),[o,l]=(0,i.useState)(""),[s,d]=(0,i.useState)(""),[c,u]=(0,i.useState)(""),[m,h]=(0,i.useState)(""),[p,x]=(0,i.useState)(!1);function getAuth(){return localStorage.getItem("token")}async function loadNotes(){let e=getAuth();if(!e){window.location.href="/login";return}let a=await fetch("/api/notes",{headers:{Authorization:`Bearer ${e}`}});if(401===a.status){localStorage.clear(),window.location.href="/login";return}let r=await a.json();t(r)}async function createNote(e){e.preventDefault();let t=getAuth(),s=await fetch("/api/notes",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({title:a,body:o})}),n=await s.json();if(403===s.status&&n.error?.includes("Upgrade")){x(!0),d("Note limit reached for Free plan");return}r(""),l(""),loadNotes()}async function del(e){let t=getAuth();await fetch(`/api/notes/${e}`,{method:"DELETE",headers:{Authorization:`Bearer ${t}`}}),loadNotes()}async function upgrade(){let e=getAuth(),t=localStorage.getItem("tenant"),a=await fetch(`/api/tenants/${t}/upgrade`,{method:"POST",headers:{Authorization:`Bearer ${e}`}});if(a.ok)d("Upgraded to Pro!"),x(!1),loadNotes();else{let e=await a.json();d(e.error||"Upgrade failed")}}return(0,i.useEffect)(()=>{u(localStorage.getItem("tenant")),h(localStorage.getItem("role")),loadNotes()},[]),(0,n.jsxs)("div",{className:"p-6 max-w-3xl mx-auto",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,n.jsxs)("h1",{className:"text-2xl font-bold",children:["Notes (",c,")"]}),(0,n.jsxs)("div",{children:[localStorage.getItem("email")," â€” ",m]})]}),(0,n.jsxs)("form",{onSubmit:createNote,className:"mb-4",children:[n.jsx("input",{value:a,onChange:e=>r(e.target.value),placeholder:"Title",className:"w-full p-2 mb-2 border rounded"}),n.jsx("textarea",{value:o,onChange:e=>l(e.target.value),placeholder:"Body",className:"w-full p-2 mb-2 border rounded"}),n.jsx("button",{className:"bg-green-600 text-white px-4 py-2 rounded",children:"Create Note"})]}),p&&(0,n.jsxs)("div",{className:"p-3 bg-yellow-100 border mb-4 rounded",children:[(0,n.jsxs)("div",{children:["Free plan limit reached.",n.jsx("button",{onClick:upgrade,className:"ml-2 px-3 py-1 bg-blue-600 text-white rounded",children:"Upgrade to Pro"})]}),n.jsx("div",{className:"text-sm mt-1",children:s})]}),n.jsx("div",{children:e?.map(e=>n.jsxs("div",{className:"border p-3 mb-2 rounded",children:[n.jsxs("div",{className:"flex justify-between",children:[n.jsx("strong",{children:e.title}),n.jsx("button",{onClick:()=>del(e._id),className:"text-red-600 hover:underline",children:"Delete"})]}),n.jsx("p",{children:e.body})]},e._id))}),n.jsx("div",{className:"mt-6 text-sm text-gray-500",children:s})]})}let d=(0,s.l)(r,"default"),c=(0,s.l)(r,"config"),u=new o.PagesAPIRouteModule({definition:{kind:l.x.PAGES_API,page:"/api/notes",pathname:"/api/notes",bundlePath:"",filename:""},userland:r})}};var t=require("../../webpack-api-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),a=t.X(0,[222],()=>__webpack_exec__(7771));module.exports=a})();